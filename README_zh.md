## 语言选择
- [English](README.md)
- [中文](README_zh.md)

---

## ValuX 是什么？

ValuX 是一个基于现金流折现模型（DCF）的 AI 股票估值工具。它自动抓取财务数据，借助 AI 实时搜索市场信息生成估值参数建议，并计算公司的内在价值 — 全部在终端中完成。

你可以把它想象成一位坐在身边的股权研究分析师：AI 帮你搜索业绩指引、分析师一致预期和行业数据，然后给出估值参数建议。你来审核和调整，AI 负责繁重的工作。

---

## 核心功能

- **AI Copilot 模式** — 基于 [Claude Code](https://docs.anthropic.com/en/docs/claude-code)（Anthropic 开发的 AI 编程工具）驱动。AI 分析公司基本面，搜索分析师预期和业绩指引，为每个 DCF 参数给出建议值和详细分析。你逐项审核，按 Enter 接受或输入新值覆盖。详见下方 [配置 AI Copilot](#4-配置-ai-copilot可选)。
- **手动模式** — 想完全自己掌控？使用 `--manual` 手动输入所有参数。
- **估值差异分析** — 估值完成后，AI 对比 DCF 结果与当前股价，搜索分析师目标价，分析差异原因并给出修正估值。
- **敏感性分析** — 生成收入增长率 × EBIT 利润率、WACC 两组敏感性分析表，展示每股价值的可能范围。
- **Excel 导出** — 将估值结果、历史数据、财务报表和 AI 差异分析导出为格式化的 Excel 工作簿。
- **全球覆盖** — 支持美股、A 股、港股等全球市场，根据不同国家的无风险利率和股权风险溢价自动计算 WACC。

---

## 工作流程

```
┌──────────────────────────────────────────────────────────────┐
│  输入股票代码  →  抓取历史财务数据                              │
│                    ↓                                         │
│  展示历史数据摘要                                              │
│                    ↓                                         │
│  AI Copilot：搜索市场数据 → 建议参数 → 你来审核                 │
│                    ↓                                         │
│  计算 DCF → 每股内在价值                                       │
│                    ↓                                         │
│  敏感性分析（收入增长 × EBIT 利润率，WACC）                     │
│                    ↓                                         │
│  [可选] AI 估值差异分析：DCF 估值 vs 当前股价                   │
│                    ↓                                         │
│  [可选] 导出 Excel                                            │
└──────────────────────────────────────────────────────────────┘
```

---

## 数据源

| 数据源 | 覆盖范围 | API Key | 说明 |
|--------|---------|---------|------|
| [**FMP**](https://financialmodelingprep.com/) | 全球（美股、A 股、港股等） | 需要 | 财务报表、市场数据、估值指标、公司信息、风险溢价等。所有市场的主要数据源。 |
| [**akshare**](https://github.com/akfamily/akshare) | A 股 | 不需要 | 用于获取中国 GAAP 原始利润表，准确计算 EBIT。FMP 对 A 股的营业利润包含了投资收益、公允价值变动等非经营项目，akshare 提供原始数据以计算剔除这些项目后的真实 EBIT。 |

---

## 安装与使用

### 1. 下载项目

```bash
git clone https://github.com/alanhewenyu/ValuX.git
cd ValuX
```

### 2. 安装依赖

需要 Python 3.8+。

```bash
pip install -r requirements.txt
```

### 3. 获取 FMP API Key

在 [Financial Modeling Prep](https://financialmodelingprep.com/) 注册账户并获取 API Key：

```bash
export FMP_API_KEY='your_api_key_here'
```

### 4. 配置 AI Copilot（可选）

AI 功能需要安装并认证 [Claude Code CLI](https://docs.anthropic.com/en/docs/claude-code)。ValuX 通过 CLI 调用 Claude 进行联网搜索和分析。使用的模型取决于你的 Claude Code 配置（默认为 Claude Sonnet）。如需切换模型（如 Claude Opus），可通过 `claude config set model` 设置。

如果 Claude CLI 不可用，ValuX 会自动切换到手动模式。

```bash
claude --version
```

### 5. 运行

```bash
python main.py              # AI copilot 模式（默认）
python main.py --manual     # 手动输入模式
```

---

## 使用步骤

1. **输入股票代码** — 如 `AAPL`、`600519.SS`（茅台）、`000333.SZ`（美的）
2. **选择数据周期** — `annual`（年度）或 `quarter`（季度）
3. **查看历史数据** — 程序展示历史财务数据摘要表
4. **AI 参数生成**（或手动输入） — AI 逐项给出建议值和分析，按 Enter 接受或输入新值
5. **查看 DCF 结果** — 每股内在价值及完整计算过程
6. **敏感性分析** — 收入增长率 × EBIT 利润率、WACC 两组敏感性表
7. **估值差异分析**（可选） — AI 分析 DCF 估值与市场价差异原因
8. **导出 Excel**（可选） — 保存为格式化的 `.xlsx` 文件

### 输入格式说明

百分比参数（收入增长率、EBIT 利润率、税率、WACC）直接输入数字：输入 `10` 表示 10%，不需要输入 `10%`。

---

## 关键估值参数说明

| 参数 | 说明 |
|------|------|
| **收入增长率（Year 1）** | 未来一年的收入预测。AI 优先参考公司业绩指引，其次参考分析师一致预期。 |
| **收入增长率（Years 2-5）** | 未来 2-5 年的复合年增长率（CAGR）。 |
| **目标 EBIT 利润率** | 公司达到成熟稳定期的 EBIT 利润率。 |
| **收敛年数** | 从当前 EBIT 利润率达到目标利润率所需的年数。 |
| **收入/投资资本比率** | 不同阶段的资本效率比率（Year 1-2、3-5、5-10）。AI 会对照历史再投资数据进行合理性校验。 |
| **税率** | 基于历史数据自动计算，可手动调整。 |
| **WACC** | 基于无风险利率、股权风险溢价和 Beta 自动计算，可手动调整。 |
| **RONIC** | 终值期新投资资本回报率。默认等于 WACC（竞争均衡），对有持续竞争优势的公司可设为 WACC + 5%。 |

---

## DCF 估值对价值投资的意义

价格是你支付的，价值是你得到的。DCF 估值通过折现未来自由现金流来估算公司的内在价值，是价值投资的基石。

本工具聚焦三个核心驱动因素：**收入增长**、**经营效率（EBIT 利润率）** 和 **再投资**。正如巴菲特所说，*"模糊的正确胜过精确的错误。"* 通过敏感性分析，即使假设不完美，也能找到投资的安全垫。

---

## 贡献与反馈

欢迎提交 Issue 或 Pull Request。联系邮箱：[alanhe@icloud.com](mailto:alanhe@icloud.com)

了解更多公司估值内容，欢迎关注微信公众号：**见山笔记**

---

## 许可证

MIT License。详见 [LICENSE](LICENSE)。
